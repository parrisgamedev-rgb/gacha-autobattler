# v0.18.1 Bug Fixes & Polish Update

## Overview

A comprehensive update addressing bugs found during playtesting, design flaws, and UI polish to bring the game from "functional" to "finished."

## Bug Fixes

### 1. Gear Card Tap Not Opening Upgrade UI

**Problem:** Tapping on gear cards in both Collection screen and Gear Inventory screen does not bring up the upgrade/enhancement UI.

**Fix:**
- Ensure gear cards emit a signal on tap/click
- Connect to a method that opens the gear upgrade UI with that gear's data
- Consistent behavior across both screens

### 2. Achievements Screen Empty

**Problem:** The achievements screen loads but displays no achievements - data isn't being loaded or displayed.

**Fix:**
- Trace from `AchievementManager` → data loading → gallery screen → card display
- Fix the broken link in that chain

---

## Design Flaw Fixes

### 3. Battle Boards (Quick Battle + Dungeons)

**Problem:** Plain tiles, poor color contrast, no environment dressing. All battles look the same.

**Fix:**
- Add environment items to battle boards (rocks, plants, debris depending on theme)
- Adjust tile/background colors for better contrast and readability
- Create distinct board themes for each dungeon type:
  - HP Dungeon → Nature/forest theme
  - Attack Dungeon → Fire/volcanic theme
  - Defense Dungeon → Stone/fortress theme
  - Speed Dungeon → Wind/sky theme
  - Mixed Dungeon → Neutral or combined theme
- Quick Battle uses a default theme or random selection

### 4. Global Cheat Menu

**Problem:** Cheats only accessible in battle via F-keys.

**Fix:**
- Create a `CheatManager` autoload (or extend existing)
- Add hidden cheat panel accessible from any screen (e.g., hold F1 for 2 seconds)
- Cheats organized by category:
  - **Currency:** Add gems, gold, materials, enhancement stones
  - **Units:** Max level all units, add random units, unlock all
  - **Progression:** Clear all stages, unlock all dungeons
  - **Battle:** Win instantly, lose instantly, infinite HP (when in battle)

---

## New Features

### 5. Unit Power Score (Combat Power / CP)

A numeric rating for each unit reflecting true combat strength.

**Calculation factors:**
- Base stats (HP, Attack, Defense, Speed) scaled by star rating
- Level multiplier
- Imprint bonus (+% per imprint level)
- Equipped gear stats

**Formula concept:**
```
CP = (HP/10 + Attack + Defense + Speed) * level_mult * imprint_mult + gear_bonus
```

**Display:** Shown on unit cards wherever they appear (collection, team select, battle roster).

### 6. Auto-Select Team

**Location:** New button on Team Select screen ("Auto Select" or "Best Team")

**Behavior:**
- Calculate CP for all owned units
- Select the 3 highest CP units not already on the team
- Simple implementation - just use raw CP, no element weighting

---

## UI Polish

### 7. Team Select Screen
- Better unit card layout with CP displayed
- Visual hierarchy: selected units highlighted, bench units clear
- Add the "Auto Select" button
- Use UI sprites (panels, frames) from existing asset pack

### 8. Dungeon Select Screen
- Card-based layout for each dungeon with icon/theme
- Clear difficulty tier selection (Easy/Normal/Hard)
- Show potential rewards per tier
- Match visual style of campaign select

### 9. Unit Card Info UI
- Cleaner stat display with icons for HP/ATK/DEF/SPD
- Show CP prominently
- Gear slots visible with equipped gear (or empty slot indicator)
- Ability preview section

### 10. Summon Screen Overhaul
- Banner display at top (featured units, rates, pity counter)
- Pull buttons with clear pricing (100 gems / 900 gems)
- Results display: dramatic reveal animation, unit cards with rarity effects (gold glow for 5-star, purple for 4-star)
- Skip button for repeat pulls

### 11. Persistent Currency Bar
- Header bar visible on all main screens
- Shows: Gems, Gold, Level Materials, Enhancement Stones (with icons)
- Create reusable `CurrencyBar` scene/component
- Connects to `PlayerData` signals for real-time updates
- Compact design

### 12. Gear Icons
- Search existing sprite packs for weapon, armor, accessory icons
- Assign icons by gear type (sword for weapon, shield for armor, ring for accessory)
- Display on gear cards in inventory and when equipped
- Rarity border/glow: white (common), green (rare), purple (epic), gold (legendary)

---

## Implementation Order

1. **Bugs first** - Gear tap fix, achievements screen (quick wins)
2. **Power score system** - Other features depend on it
3. **Auto-select + team select UI** - Uses power score
4. **Currency bar** - Appears on multiple screens
5. **Gear icons + gear tap fix** - Related work
6. **Dungeon select UI + battle boards** - Related work
7. **Unit card UI polish**
8. **Summon screen overhaul** - Biggest visual effort
9. **Global cheat menu** - Dev convenience, anytime

---

## Version Target

**v0.18.1** - Bug Fixes & Polish Update
