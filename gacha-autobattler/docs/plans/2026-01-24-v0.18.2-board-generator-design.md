# v0.18.2 Board Generator Design

## Goal

Replace the current static, repetitive battle board images with higher-quality procedurally generated boards that properly utilize existing tileset assets.

## Problem

Current boards have issues:
- Chapter 1: Basic but functional forest clearing
- Chapter 2: Obvious repetitive tiling pattern
- Chapter 3: Broken - essentially blank blue background

Meanwhile, we have extensive unused tileset assets:
- 70+ forest decoration sprites (bushes, mushrooms, stones, grass tufts)
- Multiple color variants (blue, orange, pink, purple)
- Proper autotile sheets with terrain transitions
- Dungeon tileset with decorations

## Solution

Create a Godot generator tool that composites tileset assets into polished board PNG images.

## Architecture

### Files

```
scenes/tools/board_generator.tscn  - Standalone scene to run generator
scripts/tools/board_generator.gd   - Generator logic
```

### Layer System

Boards are built bottom-to-top:

1. **Base terrain** - Tiled grass/stone floor covering entire board
2. **Terrain transitions** - Edge tiles where terrain meets borders (optional)
3. **Border elements** - Trees/walls around edges framing the play area
4. **Decorations** - Scattered bushes, mushrooms, stones avoiding center

### Board Dimensions

- Output: 1200x1120 pixels (matches current TextureRect in battle.tscn)
- Tile size: 16px (matches tileset assets)
- Center safe zone: ~600x600px kept mostly clear for 3x3 grid visibility

## Themes

### Forest (Chapter 1)

- **Base**: `grass.png` autotile variations
- **Border**: Tree canopy sprites around top and sides
- **Decorations**:
  - `decor_bush1-5.png` (green bushes)
  - `decor_grass1-4.png` (grass tufts)
  - `decor_mushroom1-4.png`
  - `decor_stone1-4.png`

### Dungeon (Chapter 2)

- **Base**: `Dungeon_WallsAndFloors.png` floor tiles
- **Border**: Wall tiles from same sheet
- **Decorations**: `DungeonDecorations.png` elements

### Dark Forest (Chapter 3)

- **Base**: `grass_dark.png` autotile variations
- **Border**: Denser, darker tree arrangement
- **Decorations**:
  - `decor_bush1-5_purple.png` (purple variant bushes)
  - `decor_mushroom1-4.png`
  - `decor_stone1-4.png`

## Output

Generator produces 9 board images:

- `forest_1.png`, `forest_2.png`, `forest_3.png`
- `dungeon_1.png`, `dungeon_2.png`, `dungeon_3.png`
- `dark_forest_1.png`, `dark_forest_2.png`, `dark_forest_3.png`

Each variation uses different random seeds for decoration placement.

## Integration

### battle.gd Updates

```gdscript
var chapter_boards = {
    1: [
        "res://assets/board/boards/forest_1.png",
        "res://assets/board/boards/forest_2.png",
        "res://assets/board/boards/forest_3.png"
    ],
    2: [
        "res://assets/board/boards/dungeon_1.png",
        "res://assets/board/boards/dungeon_2.png",
        "res://assets/board/boards/dungeon_3.png"
    ],
    3: [
        "res://assets/board/boards/dark_forest_1.png",
        "res://assets/board/boards/dark_forest_2.png",
        "res://assets/board/boards/dark_forest_3.png"
    ]
}
```

- Campaign: Uses chapter-appropriate theme with random variation
- Quick Battle: Picks randomly from all 9 boards
- Dungeons: Can map to appropriate theme

### Cleanup

After confirming new boards work:
- Delete `chapter_1_board.png`, `chapter_2_board.png`, `chapter_3_board.png`
- Delete `forest_board.png`, `dungeon_board.png` if replaced

## Technical Notes

### Decoration Placement Rules

1. Skip placement if position overlaps CENTER_SAFE_ZONE
2. Reduce density in safe zone (allow sparse decorations)
3. Avoid overlapping other decorations (min distance check)
4. Higher density near borders, sparser toward center

### Tileset Extraction

The autotile sheets contain multiple tile variants in a grid. Generator will:
1. Define tile regions (Rect2) for each usable tile
2. Randomly select from variants when tiling
3. Use AtlasTexture to extract specific regions

### Rendering Approach

Using SubViewport capture:
1. Build scene with Sprite2D nodes
2. Wait one frame for rendering
3. Get viewport texture as Image
4. Save to PNG with `image.save_png()`
